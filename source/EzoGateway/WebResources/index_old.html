<!DOCTYPE html>
<html>
<head>
    <title>EzoGateway</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/uikit.min.css" />
    <script src="js/uikit.min.js"></script>
    <script src="js/uikit-icons.min.js"></script>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script>
        $(document).ready(function () {
            $.ajaxSetup({ cache: false });
            
            $(".uk-navbar-nav a").click(function () {
                $(".uk-navbar-nav li").removeClass("uk-active");
                $(this).parent().addClass("uk-active");
            });

            $("#nav-live a").click(function () {
                $('#content').load("live.html");
            });

            $("#nav-cal-ph a").click(function () {
                $("#nav-cal").addClass("ul-active");
                $('#content').load("cal/ph.html .uk-card-body");

                initCalPh();
            });
            $("#nav-cal-orp a").click(function () {
                $("#nav-cal").addClass("ul-active");
                $('#content').load("cal/orp.html .uk-card-body");

                initCalOrp();
            });
            $("#nav-cal-rtd a").click(function () {
                $("#nav-cal").addClass("ul-active");
                $('#content').load("cal/rtd.html .uk-card-body");

                initCalRtd();
            });

            $("#nav-sys-config a").click(function () {
                $("#nav-sys").addClass("ul-active");
                $('#content').load("config.html .uk-card-body");

                initSysConf();
            });

            //cal ph
            $("#continuousReadingPh").click(function () {
                window.open("ph-live.html", "_blank", "toolbar=no,menubar=no,scrollbars=no,status=no,resizable=no,top=500,left=500,width=400,height=400");
            });

            //sys conf
            $('#saveConfig').click(function () {
                console.log("submit");
                var json = ConvertFormToGeneralSettings();
                $.ajax({
                    type: "PUT",
                    contentType: "application/json; charset=utf-8",
                    url: "../api/config",
                    data: JSON.stringify(json)
                }).done(function () {
                    console.log("success")
                }).fail(function () {
                    console.log("error");
                });

                return true;
            });
        });

        function initCalPh() {
            $.getJSON('../../api/cal/ph', function (data) {
                //console.log(data);
                var calPoints = data["StoredCalibPoints"];

                if (calPoints > 0) {
                    $("#calState p").html("The EZO&trade; pH Circuit is currently calibrated at <strong>" +
                        calPoints + "</strong> point" + calPoints == 1 ? "." : "s.");
                    $("#calState").removeClass("uk-alert-danger");
                    $("#calState").addClass("uk-alert-success");
                }
            });
        }

        function initCalOrp() {

        }

        function initCalRtd() {
            $.getJSON('../api/cal/rtd', function (data) {
                console.log(data);
                var calPoints = data["StoredCalibPoints"];
                var unitSymbol = data["UnitScale"];

                if (calPoints > 0) {
                    $("#calState p").html("The EZO&trade; RTD Circuit is currently calibrated.");
                    $("#calState").removeClass("uk-alert-danger");
                    $("#calState").addClass("uk-alert-success");
                }

                $("#refLabel").text("Reference Value (in " + unitSymbol + "):");
            });
        }


        function initSysConf() {
            $.getJSON('../api/config', function (data) {
                console.log(data);
                $('#ph-active').prop("checked", data["PhSensor"].Enabled);
                $('#ph-address').val(data["PhSensor"].I2CAddress);
                $('#orp-active').prop("checked", data["RedoxSensor"].Enabled);
                $('#orp-address').val(data["RedoxSensor"].I2CAddress);
                $('#rtd-active').prop("checked", data["TemperatureSensor"].Enabled);
                $('#rtd-address').val(data["TemperatureSensor"].I2CAddress);
                $('#ph-tempcompensation').prop("checked", data.EnablePhTemperatureCompensation);
                $('#temp-unit').val(data.TemperatureUnit);
            });
        }

        function ConvertFormToGeneralSettings() {
            var phSensor = new Object();
            phSensor.Enabled = $('#ph-active').is(":checked");
            phSensor.I2CAddress = $('#ph-address').val();
            var redoxSensor = new Object();
            redoxSensor.Enabled = $('#orp-active').is(":checked");
            redoxSensor.I2CAddress = $('#orp-address').val();
            var temperatureSensor = new Object();
            temperatureSensor.Enabled = $('#rtd-active').is(":checked");
            temperatureSensor.I2CAddress = $('#rtd-address').val();

            var settings = new Object();
            settings.PhSensor = phSensor;
            settings.RedoxSensor = redoxSensor;
            settings.TemperatureSensor = temperatureSensor;
            settings.EnablePhTemperatureCompensation = $('#ph-tempcompensation').is(":checked");
            settings.TemperatureUnit = $('#temp-unit').val();

            console.log(settings);

            return settings;
        }
    </script>
</head>
<body>
    <div class="uk-container">
        <div class="uk-section uk-section-muted uk-section-xsmall">
            <nav class="uk-navbar-container" uk-navbar>
                <div class="uk-navbar-left">
                    <a class="uk-navbar-item uk-logo">EzoGateway</a>
                </div>
                <div class="uk-navbar-right">
                    <ul class="uk-navbar-nav">
                        <li class="uk-active" id="nav-live"><a href="#">Live</a></li>
                        <li id="nav-cal">
                            <a href="#">Calib</a>
                            <div class="uk-navbar-dropdown">
                                <ul class="uk-nav uk-navbar-dropdown-nav">
                                    <li class="uk-active" id="nav-cal-ph"><a href="#">pH Sensor</a></li>
                                    <li id="nav-cal-orp"><a href="#">Redox Sensor</a></li>
                                    <li id="nav-cal-rtd"><a href="#">Temperature Sensor</a></li>
                                </ul>
                            </div>
                        </li>
                        <li id="nav-sys">
                            <a href="#">System</a>
                            <div class="uk-navbar-dropdown">
                                <ul class="uk-nav uk-navbar-dropdown-nav">
                                    <li class="uk-active" id="nav-sys-sensors"><a href="#">Sensors</a></li>
                                    <li id="nav-sys-config"><a href="#">Settings</a></li>
                                    <li id="nav-sys-about"><a href="#">About</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>

                </div>
            </nav>
        </div>

        <div class="uk-section">
            <div class="uk-container uk-container-small" uk-height-viewport="expand: true" id="content"></div>
        </div>

        <div class="uk-section uk-section-muted">
            <div class="uk-container uk-container-small">
                footer
            </div>
        </div>
    </div>
</body>
</html>